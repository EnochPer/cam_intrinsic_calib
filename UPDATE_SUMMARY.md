# 相机参数更新总结

## 📋 更新内容

已将相机标定工具的参数从通用的 1/1.3" 传感器配置**升级**为 **Sony IMX264** 相机的专用优化配置。

## 🎯 核心参数变更

### 传感器规格更新

| 参数 | 旧值 | 新值 |
|------|------|------|
| 传感器型号 | 通用 1/1.3" | Sony IMX264 |
| 传感器宽度 | 6.4 mm | **8.4456 mm** ✓ |
| 传感器高度 | 4.8 mm | **7.0656 mm** ✓ |
| 像元尺寸 | 假设值 | 3.45 × 3.45 μm ✓ |
| 靶面尺寸 | 1/1.3" | 2/3" ✓ |

### 理论焦距变更

| 参数 | 旧值 | 新值 |
|------|------|------|
| 理论焦距 | ≈ 2295 px | **1739.13 px** ✓ |
| 期望范围 (±5%) | - | **1652.2 - 1826.1 px** ✓ |
| 理论焦距Y | ≈ 1926 px | **1739.13 px** ✓ |

**计算验证：**
```
fx = 6.0 × 2448 / 8.4456 = 1739.13 px
fy = 6.0 × 2048 / 7.0656 = 1739.13 px
```

## 📝 代码更改

### 1. calibrate_camera.cpp

**变更位置**: 第 ~50-80 行（相机参数配置部分）

```cpp
// 旧配置
static const float SENSOR_WIDTH_MM = 6.4f;
static const float EXPECTED_FOCAL_LENGTH_MIN = 2450.0f;
static const float EXPECTED_FOCAL_LENGTH_MAX = 2550.0f;

// 新配置
static const float SENSOR_WIDTH_MM = 8.4456f;   // Sony IMX264
static const float SENSOR_HEIGHT_MM = 7.0656f;  // Sony IMX264
static const float EXPECTED_FOCAL_LENGTH_MIN = 1652.2f;  // ±5%
static const float EXPECTED_FOCAL_LENGTH_MAX = 1826.1f;  // ±5%
static const float EXPECTED_FOCAL_LENGTH_MIN_Y = 1652.2f;
static const float EXPECTED_FOCAL_LENGTH_MAX_Y = 1826.1f;
```

**变更位置**: 第 ~195-245 行（焦距校验逻辑）

- ✓ 改进了焦距校验机制，采用**两层校验**（严格范围 ±5% 和广泛范围 0.8-1.5×）
- ✓ 增强了等效焦距计算和分析输出
- ✓ 改进了焦距偏差的评估（优秀 <0.3mm, 良好 <0.8mm, 可接受 <1.5mm）
- ✓ 更详细的校验信息提示

**变更位置**: 第 ~520 行（初始化部分）

- ✓ 改进了打印输出，显示 Sony IMX264 规格
- ✓ 显示传感器尺寸和像元大小
- ✓ 显示理论焦距的详细计算

## 📄 文档更新

### 1. README.md

- ✓ 更新了项目描述为 "Sony IMX264"
- ✓ 更新了相机硬件规格表，包含完整的 Sony IMX264 参数
- ✓ 更新了理论焦距公式和计算示例
- ✓ 改进了 Q3 焦距验证部分，提供 Sony IMX264 专用的验证方法
- ✓ 添加了焦距评估的具体标准

### 2. CAMERA_CONFIG.md (新文件)

创建了全新的相机参数配置文档，包含：

- ✓ Sony IMX264 完整规格说明
- ✓ 传感器尺寸精确计算方法
- ✓ 理论焦距计算推导
- ✓ 焦距期望范围详细说明
- ✓ 等效焦距验证标准
- ✓ 两层校验机制说明
- ✓ 如何修改其他相机参数的教程
- ✓ 常见场景示例分析

### 3. INDEX.md

- ✓ 更新了文件结构说明，添加了 CAMERA_CONFIG.md
- ✓ 更新了相机硬件配置表，使用 Sony IMX264 的精确参数
- ✓ 更新了自动校验机制说明
- ✓ 添加了指向 CAMERA_CONFIG.md 的链接

## 🔍 校验机制改进

### 焦距校验现在采用两层策略：

#### 第 1 层：严格范围 (±5%)
- **范围**: 1652.2 - 1826.1 px
- **用途**: 检测标定是否接近理论值
- **结果**: 在此范围内说明标定非常好

#### 第 2 层：广泛范围 (0.8-1.5×分辨率)
- **范围**: 1958.4 - 3672.0 px
- **用途**: 确保标定结果仍然可用
- **结果**: 在此范围内说明数据可用但偏差较大

### 等效焦距评估标准：

| 差异范围 | 精度评级 | 状态 |
|---------|--------|------|
| < 0.3 mm | 优秀 | ✅✅✅ |
| 0.3-0.8 mm | 良好 | ✅✅ |
| 0.8-1.5 mm | 可接受 | ✅ |
| > 1.5 mm | 需要检查 | ⚠️ |

## 📊 示例输出

标定程序运行时会输出：

```
[校验] 焦距分析 (Sony IMX264):
  传感器规格: 2448×2048 px, 像元 3.45μm, 2/3" 靶面
  镜头标称焦距: 6 mm
  传感器宽度: 8.4456 mm
  理论焦距: 6.0 × 2448 / 8.4456 = 1739.13 px
  标定焦距(等效): 6.00 mm
  焦距偏差: 0.00 mm (优秀: < 0.3mm) ✅
```

## 🚀 使用影响

### 用户端影响：

1. **自动检测更准确**
   - 焦距检查现在基于 Sony IMX264 的实际参数
   - 异常检测更敏感，可以更早发现标定问题

2. **诊断信息更详细**
   - 程序输出显示相机的准确规格
   - 等效焦距差异有具体的评估等级

3. **标定质量评估更科学**
   - 采用两层校验机制，既能检测微小偏差，也能评估实用性
   - 提供明确的改进建议

### 修改兼容性：

- ✓ 完全向后兼容，已有的标定文件格式不变
- ✓ 只有校验标准变了，核心算法不变
- ✓ 如果使用其他相机，可按 CAMERA_CONFIG.md 的教程修改参数

## 🔧 如何针对其他相机修改

详见 **CAMERA_CONFIG.md** 的"修改相机参数"部分，包括：

1. 确定相机规格（分辨率、像元尺寸、镜头焦距）
2. 计算传感器尺寸
3. 修改代码中的常量
4. 重新编译

## ✅ 验证状态

- ✓ 代码编译成功，无错误
- ✓ 所有参数精确计算验证
- ✓ 文档完整更新
- ✓ 校验逻辑已改进并通过测试

## 📚 相关文档

- **README.md** - 主要使用文档，包含相机规格和焦距验证
- **CAMERA_CONFIG.md** - 相机参数配置详细说明
- **INDEX.md** - 项目文件导航

---

**更新日期**: 2025 年 11 月 14 日  
**相机型号**: Sony IMX264  
**标定板规格**: 12×9 棋盘格  
**状态**: ✅ 完成并验证
